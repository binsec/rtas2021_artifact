\RequirePackage{fancyvrb,keyval,ifthen}\ProvidesPackage{progSTF}[\filedate]% ------------------------------------------------------------------------------% Program options% ------------------------------------------------------------------------------% title : Title of the program box, defaults to "source code"% width : Width of the program box, defaults to \textwidth% align : Alignment of the box (center of intext), defaults to center\define@key{progSTF}{width}{\def\progSTF@width{#1}}\define@key{progSTF}{title}{\def\progSTF@title{#1}}\define@key{progSTF}{align}{\def\progSTF@align{#1}}% ------------------------------------------------------------------------------% Program environment definition% ------------------------------------------------------------------------------\newcounter{transform@count}\newenvironment{prog}{\scriptsize\VerbatimEnvironment\def\codekeywordcolor{\darkgreen}%  \begin{Verbatim}[baselinestretch=1,commandchars=\\\{\},%    frame=none,codes={\catcode`$=3\catcode`_=8\catcode`^=7\catcode`~=\active\def~{\rlap{\gray\hskip.5ex\vbox to 0pt{\vss\hbox{$\strut$\vline}}}\ }},xleftmargin=2mm,xrightmargin=3mm]}    {\end{Verbatim}}\newenvironment{fprogbox}{\newbox\fpbox%  \setbox\fpbox\hbox\bgroup\vbox\bgroup}{\egroup\egroup%  \psshadowbox{\hspace{-2mm}\unhbox\fpbox\hspace{-2mm}}}\newenvironment{fprog}{\VerbatimEnvironment%  \begin{fprogbox}\begin{prog}}  {\end{prog}\vspace{-2.5ex}\end{fprogbox}}\newenvironment{program}[1]{\VerbatimEnvironment\def\progSTF@align{center}\def\progSTF@width{\textwidth}\def\progSTF@title{}\setkeys{progSTF}{#1}\ifthenelse{\equal{\progSTF@align}{center}}{\begin{center}}{}\begin{minipage}[t]{\progSTF@width}\begin{Verbatim}[label=\textit{\progSTF@title},commandchars=\\\{\},frame=single,codes={\catcode`$=3\catcode`_=8\catcode`^=7\catcode`~=\active\def~{\hbox to 0pt{\hskip.5ex$\strut$\vline\hss} }},xleftmargin=2mm,xrightmargin=3mm]}{\end{Verbatim}\end{minipage}\ifthenelse{\equal{\progSTF@align}{center}}{\end{center}}{}}\newenvironment{transform}[1]{\vspace{-4mm}\setcounter{transform@count}{0}\def\transform@name{#1}\relax\begin{center}}{\end{center}}\newenvironment{tprogram}{\VerbatimEnvironment\addtocounter{transform@count}{1}\ifnum\value{transform@count}=1\def\transform@title{before \transform@name}\else\def\transform@title{after \transform@name}\hspace{5mm}\fi\begin{program}{title=\transform@title,width=8cm,align=intext}}{\end{program}}% ------------------------------------------------------------------------------% In-program commands% ------------------------------------------------------------------------------\newcommand \for {{\it for}}